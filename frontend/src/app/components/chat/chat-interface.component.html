<div class="chat-app">
  <!-- Repository Sidebar -->
  <aside class="repo-sidebar">
    <div class="sidebar-header">
      <h2>Repositories</h2>
      <button class="btn-secondary" (click)="refreshRepositories()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z"></path>
        </svg>
        Refresh
      </button>
    </div>
    
    <div class="search-section">
      <div class="search-input">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="search-icon">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path>
        </svg>
        <input type="text" placeholder="Search repositories..." [(ngModel)]="repositoryFilter">
      </div>
    </div>
    
    <div class="repo-list">
      <div class="repo-section" *ngIf="selectedRepositories.length > 0">
        <h3>Selected ({{ selectedRepositories.length }})</h3>
        <div class="repo-items">
          <div class="repo-item selected" *ngFor="let repo of selectedRepositories">
            <label class="repo-checkbox">
              <input type="checkbox" [checked]="true" (change)="toggleRepository(repo)">
              <span class="checkmark"></span>
              <div class="repo-info">
                <span class="repo-name">{{ repo.name }}</span>
                <span class="repo-tech">{{ repo.technology }}</span>
              </div>
            </label>
          </div>
        </div>
      </div>
      
      <div class="repo-section">
        <h3>Available ({{ filteredRepositories.length }})</h3>
        <div class="repo-items">
          <div class="repo-item" *ngFor="let repo of filteredRepositories">
            <label class="repo-checkbox">
              <input type="checkbox" [checked]="false" (change)="toggleRepository(repo)">
              <span class="checkmark"></span>
              <div class="repo-info">
                <span class="repo-name">{{ repo.name }}</span>
                <span class="repo-tech">{{ repo.technology }}</span>
              </div>
            </label>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Chat Area -->
  <main class="chat-main">
    <!-- Header -->
    <header class="chat-header">
      <div class="header-content">
        <div class="header-title">
          <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" class="ai-icon">
            <path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Z"></path>
          </svg>
          <div>
            <h1>DocXP AI Assistant</h1>
            <span class="subtitle" *ngIf="selectedRepositories.length > 0">
              Analyzing {{ selectedRepositories.length }} repositories
            </span>
          </div>
        </div>
        <button class="btn-ghost" (click)="clearChat()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>
          </svg>
          Clear Chat
        </button>
      </div>
    </header>

    <!-- Messages -->
    <div class="messages-container" #messagesContainer>
      <div class="messages" *ngIf="messages.length > 0">
        <div class="message" *ngFor="let message of messages" [ngClass]="message.type">
          <!-- User Message -->
          <div class="user-message" *ngIf="message.type === 'user'">
            <div class="message-content">{{ message.content }}</div>
            <time class="timestamp">{{ formatTimestamp(message.timestamp) }}</time>
          </div>

          <!-- Assistant Message -->
          <div class="assistant-message" *ngIf="message.type === 'assistant'">
            <div class="avatar">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Z"></path>
              </svg>
            </div>
            <div class="message-wrapper">
              <div class="message-content" *ngIf="!message.isLoading" [innerHTML]="message.content | markdown"></div>
              <div class="loading-content" *ngIf="message.isLoading">
                <div class="loading-dots">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
                <span>Analyzing your request...</span>
              </div>
              <time class="timestamp">{{ formatTimestamp(message.timestamp) }}</time>
            </div>
          </div>
        </div>
      </div>

      <!-- Welcome/Suggestions -->
      <div class="welcome-section" *ngIf="messages.length <= 1">
        <div class="suggestions">
          <h3>Try asking:</h3>
          <div class="suggestion-grid">
            <button 
              class="suggestion-btn" 
              *ngFor="let question of suggestedQuestions"
              (click)="useSuggestedQuestion(question)">
              {{ question }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Input -->
    <footer class="chat-input">
      <div class="input-container">
        <div class="input-wrapper">
          <textarea 
            #messageInput
            placeholder="Ask about your codebase..."
            [(ngModel)]="currentMessage"
            (keydown)="onKeyDown($event)"
            [disabled]="isLoading"
            rows="1"></textarea>
          <button 
            class="btn-primary" 
            (click)="sendMessage()"
            [disabled]="!currentMessage.trim() || isLoading">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" *ngIf="!isLoading">
              <path d="M.5 1.163A1 1 0 0 1 1.97.28l12.868 6.837a1 1 0 0 1 0 1.766L1.969 15.72A1 1 0 0 1 .5 14.836v-3.97c0-.69.48-1.29 1.161-1.414L9.736 8 1.661 6.548A1.5 1.5 0 0 1 .5 5.133V1.163Z"></path>
            </svg>
            <div class="loading-spinner" *ngIf="isLoading"></div>
            Send
          </button>
        </div>
        <div class="input-hint">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path>
          </svg>
          Press Enter to send, Shift+Enter for new line
        </div>
      </div>
    </footer>
  </main>
</div>