<div class="aws-config-container">
  <p-toast></p-toast>
  
  <!-- Header with current status -->
  <div class="config-header">
    <div class="status-section">
      <h2 class="header-title">AWS Configuration</h2>
      <div class="status-indicator">
        <p-tag 
          [value]="getConnectionStatusText()"
          [severity]="getConnectionStatusSeverity()"
          icon="pi pi-aws">
        </p-tag>
        <span class="status-details" *ngIf="awsStatus && awsStatus.connected">
          {{awsStatus.available_models_count}} models available in {{awsStatus.region}}
        </span>
      </div>
    </div>
  </div>

  <p-divider></p-divider>

  <!-- Authentication Method Selection -->
  <p-tabView [(activeIndex)]="activeTab" class="auth-tabs">
    
    <!-- Access Keys Tab -->
    <p-tabPanel header="Access Keys" leftIcon="pi pi-key">
      <div class="tab-content">
        <div class="method-description">
          <p class="description-text">
            Use AWS Access Key ID and Secret Access Key for authentication. 
            This method is suitable for programmatic access and CI/CD environments.
          </p>
        </div>

        <form [formGroup]="accessKeysForm" class="auth-form">
          <div class="form-row">
            <div class="form-group">
              <label for="accessKeyId" class="form-label">Access Key ID *</label>
              <input 
                pInputText 
                id="accessKeyId"
                formControlName="aws_access_key_id"
                placeholder="AKIA..."
                class="form-input"
                [class.ng-invalid]="accessKeysForm.get('aws_access_key_id')?.invalid && accessKeysForm.get('aws_access_key_id')?.touched">
              <small class="error-message" 
                *ngIf="accessKeysForm.get('aws_access_key_id')?.invalid && accessKeysForm.get('aws_access_key_id')?.touched">
                Access Key ID is required
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="secretKey" class="form-label">Secret Access Key *</label>
              <input 
                pInputText 
                id="secretKey"
                type="password"
                formControlName="aws_secret_access_key"
                placeholder="Enter secret key"
                class="form-input"
                [class.ng-invalid]="accessKeysForm.get('aws_secret_access_key')?.invalid && accessKeysForm.get('aws_secret_access_key')?.touched">
              <small class="error-message"
                *ngIf="accessKeysForm.get('aws_secret_access_key')?.invalid && accessKeysForm.get('aws_secret_access_key')?.touched">
                Secret Access Key is required
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="sessionToken" class="form-label">Session Token (Optional)</label>
              <input 
                pInputText 
                id="sessionToken"
                formControlName="aws_session_token"
                placeholder="For temporary credentials"
                class="form-input">
              <small class="help-text">
                Only required for temporary security credentials
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="accessKeysRegion" class="form-label">AWS Region *</label>
              <p-dropdown 
                formControlName="aws_region"
                [options]="regions"
                optionLabel="label"
                optionValue="value"
                placeholder="Select region"
                class="form-dropdown"
                [class.ng-invalid]="accessKeysForm.get('aws_region')?.invalid && accessKeysForm.get('aws_region')?.touched">
              </p-dropdown>
            </div>
          </div>

          <div class="form-actions">
            <p-button 
              label="Test Connection"
              icon="pi pi-check"
              [loading]="testing"
              (onClick)="testAccessKeysCredentials()"
              severity="secondary"
              class="test-btn">
            </p-button>
            
            <p-button 
              label="Save Configuration"
              icon="pi pi-save"
              [loading]="configuring"
              (onClick)="configureAccessKeys()"
              class="save-btn">
            </p-button>
          </div>
        </form>
      </div>
    </p-tabPanel>

    <!-- SSO Profile Tab -->
    <p-tabPanel header="SSO Profile" leftIcon="pi pi-user">
      <div class="tab-content">
        <div class="method-description">
          <p class="description-text">
            Use AWS SSO profile for authentication. This method uses profiles configured 
            in your AWS CLI (~/.aws/config).
          </p>
        </div>

        <form [formGroup]="ssoProfileForm" class="auth-form">
          <div class="form-row">
            <div class="form-group">
              <label for="awsProfile" class="form-label">AWS Profile *</label>
              <p-dropdown 
                formControlName="aws_profile"
                [options]="getAwsProfileOptions()"
                optionLabel="label"
                optionValue="value"
                placeholder="Select AWS profile"
                [loading]="loading"
                class="form-dropdown"
                [class.ng-invalid]="ssoProfileForm.get('aws_profile')?.invalid && ssoProfileForm.get('aws_profile')?.touched">
              </p-dropdown>
              <small class="help-text">
                Profiles from ~/.aws/config and ~/.aws/credentials
              </small>
              <small class="error-message"
                *ngIf="ssoProfileForm.get('aws_profile')?.invalid && ssoProfileForm.get('aws_profile')?.touched">
                AWS Profile is required
              </small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="ssoRegion" class="form-label">AWS Region *</label>
              <p-dropdown 
                formControlName="aws_region"
                [options]="regions"
                optionLabel="label"
                optionValue="value"
                placeholder="Select region"
                class="form-dropdown"
                [class.ng-invalid]="ssoProfileForm.get('aws_region')?.invalid && ssoProfileForm.get('aws_region')?.touched">
              </p-dropdown>
            </div>
          </div>

          <div class="form-actions">
            <p-button 
              label="Test Connection"
              icon="pi pi-check"
              [loading]="testing"
              (onClick)="testSSProfileCredentials()"
              severity="secondary"
              class="test-btn">
            </p-button>
            
            <p-button 
              label="Save Configuration"
              icon="pi pi-save"
              [loading]="configuring"
              (onClick)="configureSSProfile()"
              class="save-btn">
            </p-button>
          </div>
        </form>

        <div class="sso-help" *ngIf="awsProfiles.length === 0">
          <p-message severity="info">
            <p>No AWS profiles found. To use SSO authentication:</p>
            <ol>
              <li>Configure AWS CLI: <code>aws configure sso</code></li>
              <li>Set up your SSO session</li>
              <li>Refresh this page</li>
            </ol>
          </p-message>
        </div>
      </div>
    </p-tabPanel>
  </p-tabView>

  <p-divider></p-divider>

  <!-- Model Selection -->
  <div class="model-selection-section">
    <h3 class="section-title">Bedrock Model Selection</h3>
    <p class="section-description">
      Choose the AI model to use for documentation generation
    </p>
    
    <div class="model-selector">
      <div class="form-group">
        <label for="modelSelect" class="form-label">AI Model</label>
        <p-dropdown 
          [(ngModel)]="selectedModel"
          [options]="availableModels"
          optionLabel="description"
          optionValue="id"
          placeholder="Select a model"
          (onChange)="setBedrockModel()"
          class="model-dropdown">
          
          <ng-template pTemplate="selectedItem">
            <div class="model-item" *ngIf="selectedModel">
              <span class="model-name">{{getSelectedModelName()}}</span>
              <small class="model-provider">{{getSelectedModelProvider()}}</small>
            </div>
          </ng-template>
          
          <ng-template pTemplate="item" let-model>
            <div class="model-item">
              <span class="model-name">{{model.name}}</span>
              <small class="model-provider">{{model.provider}}</small>
            </div>
          </ng-template>
        </p-dropdown>
      </div>
    </div>

    <div class="model-info" *ngIf="availableModels.length > 0">
      <p-message severity="success">
        Found {{availableModels.length}} compatible models for text generation
      </p-message>
    </div>
  </div>
</div>